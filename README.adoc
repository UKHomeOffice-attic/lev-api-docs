Life Event Verification (LEV) API Guide
=======================================
:toc:
:numbered:

== This is a work in progress!
In the meantime please refer to the original docs at https://github.com/UKHomeOffice/lev-api-docs/blob/master/README.md

== An important note
The contents of the lev-api-docs repo is automatically generated so please don't make changes directly to this repo!

== Mock API
It is possible to run a mock version of the API as follows:

=== Running a mock API with docker
The easiest way to run the mock API is with Docker
```
./mock/run_mock_api_docker.sh
```

=== Running a mock API without docker
It is also possible to run it without docker if you have the wiremock jar file:
```
cd mock
java -jar wiremock.jar --port=8080
```

== Authenticating yourself with the API

To use the API you will need to provide 2 forms of authentication:
. A client certificate
. An auth token, which must be obtained by hitting the /oauth/login endpoint

*NB: The client certificate must be included in every request, but is NOT shown in this documentation.*

The following examples are provided to help troubleshoot any issues:

=== Valid request with credentials
*Example request with dummy credentials using curl*
include::snippets/auth/valid-auth/curl-request.adoc[]

*Example response*
include::snippets/auth/valid-auth/http-response.adoc[]

== Requesting birth record data

=== Requesting a specific birth record using a System Number

The best way to get birth data is by providing the relevant System Number, a nine digit unique identifier for the birth record.

*Example request specifying a System Number using curl*
include::snippets/system-number/matching-record-999999901/curl-request.adoc[]

*Example response* is a JSON object containing the birth record data
include::snippets/system-number/matching-record-999999901/http-response.adoc[]

=== Searching for a birth record

When the System Number of the birth record is not known, a search of the records can be made by supplying the following three parameters in the URL query string:

- `forenames` : the first name is mandatory, and can be accompanied by any middle names (all separated by spaces)
- `lastname` : the last name is mandatory
- `dateofbirth` : the date of birth is also mandatory

*Example request with search parameters using curl*
include::snippets/search/multiple-matching-record/curl-request.adoc[]

*Example response* is a JSON array containing three matching birth records
include::snippets/search/multiple-matching-record/http-response.adoc[]

TIP: The API will only return at most *25* matching records. In the unlikely case where there might be more than 25 people with the same first name, last name, and date of birth; you will have to add middle names to the query to make the search more exacting.

=== When no matching records are found

If no records matching the search terms can be found, the API will return an empty array.

*Example request*
include::snippets/search/no-matches/curl-request.adoc[]

*Example response*
include::snippets/search/no-matches/http-response.adoc[]

== Common errors and responses

=== 404 - Not found

Making a request to an unsupported end point will result in the standard 404 not found error.

=== Missing search parameters

Missing search parameters will result in a standard 400 bad request error.

*Example request missing with missing the `forenames` parameter*
include::snippets/search/no-forenames/curl-request.adoc[]

*Example response detailing the error*
include::snippets/search/no-forenames/http-response.adoc[]




